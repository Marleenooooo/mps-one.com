import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';
import { getGeoInfo } from '../services/geo';
import { getPreferredLanguage, setPreferredLanguage } from '../services/i18n';

export type Language = 'en' | 'id';

type I18nContextValue = {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
};

const translations: Record<Language, Record<string, string>> = {
  en: {
    // Auth / Login
    'auth.login_title': 'Sign in to MPSOne',
    'auth.login_subtitle': 'Enterprise procurement suite for Kalimantan mining companies',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.password_placeholder': 'Enter your password',
    'auth.remember_me': 'Remember me',
    'auth.forgot_password': 'Forgot password?',
    'auth.role': 'Sign in as',
    'auth.role_hint': 'Role-based permissions: Admin, PIC Operational, PIC Procurement, PIC Finance',
    'auth.sign_in': 'Sign In',
    'auth.or': 'or',
    'auth.sso': 'Sign in with SSO',
    'auth.sso_hint': 'SSO integration placeholder (Azure AD / Google Workspace)',
    'auth.security_notice': 'Security: WCAG AA, secure forms, and protected routes',
    'auth.version': 'Version {v}',
    'auth.login_success': 'Welcome {email}',
    'auth.error_email': 'Please enter a valid email address',
    'auth.error_password': 'Password must be at least 6 characters',
    'auth.choose_who': 'Who are you?',
    'auth.i_am_supplier': 'I am a Supplier',
    'auth.i_am_client': 'I am a Client',
    'auth.role_explain': 'Suppliers sign in as Admin. Clients choose a PIC role.',
    'auth.mode_supplier': 'Supplier mode selected',
    'auth.mode_client': 'Client mode selected',
    'auth.supplier_admin_assumed': 'Supplier Admin access assumed for this environment',
    'auth.use_code': 'Sign in with Code',
    'auth.join_with_code_hint': 'Enter the access code provided by your admin to auto-configure your account.',
    'auth.code_invalid': 'Invalid code',
    'auth.code_success': 'Access granted',
    'auth.code_number': 'Code number',
    'auth.continue': 'Continue',
    'department.name': 'Department',
    'clipboard.copied': 'Copied',

    // Role descriptions
    'roles.pic_operational_desc': 'Daily receiving, delivery confirmation, delivery letter corrections.',
    'roles.pic_procurement_desc': 'PR creation, supplier quotes, PO generation, vendor coordination.',
    'roles.pic_finance_desc': 'Invoice verification, payment scheduling, payment status tracking.',

    // Admin invites
    'admin.invite_user': 'Invite User',
    'admin.invites.title': 'Manage Invites',
    'admin.invites.none': 'No invites yet.',
    'admin.invites.code': 'Code',
    'admin.invites.expires_at': 'Expires At',
    'admin.invites.status': 'Status',
    'admin.invites.revoke': 'Revoke',
    // Approval Workflows
    'approval_workflow.title': 'Approval Workflows',
    'approval_workflow.subtitle': 'Approval Workflow Management',
    'approval_workflow.description': 'Configure multi-level approval processes with SLAs and escalation rules',
    'approval_workflow.create_workflow': 'Create Workflow',
    'approval_workflow.edit_workflow': 'Edit Workflow',
    'approval_workflow.workflow_name': 'Workflow Name',
    'approval_workflow.document_type': 'Document Type',
    'approval_workflow.department': 'Department',
    'approval_workflow.amount_range': 'Amount Range',
    'approval_workflow.steps': 'Steps',
    'approval_workflow.sla': 'SLA',
    'approval_workflow.status': 'Status',
    'approval_workflow.active': 'Active',
    'approval_workflow.inactive': 'Inactive',
    'approval_workflow.min_amount': 'Minimum Amount',
    'approval_workflow.max_amount': 'Maximum Amount',
    'approval_workflow.total_workflows': 'Total Workflows',
    // General
    'general.home': 'Home',

    // Navigation
    'nav.admin_dashboard': 'Admin Dashboard',
    'nav.client_dashboard': 'Client Dashboard',
    'nav.onboarding': 'Corporate Onboarding',
    'nav.purchase_requests': 'Purchase Requests',
    'nav.quote_builder': 'Quote Builder',
    'nav.order_tracker': 'Order Tracker',
    'nav.docs': 'Document Manager',
    'nav.comms': 'Communication Hub',
    'nav.email_dashboard': 'Email Dashboard',
    'nav.reporting': 'Reporting',
    'nav.help': 'Help Center',
    'nav.people': 'People',
    'nav.invitations': 'Invitations',
    'nav.approval_workflows': 'Approval Workflows',
    'nav.departmental_budgets': 'Departmental Budgets',
    'nav.contracts': 'Contracts',
    'nav.invoice_matching': 'Invoice Matching',
    'nav.payments': 'Payments',
    'nav.suppliers': 'Suppliers',
    'suppliers_manager': 'Suppliers Manager',
    'suppliers_list': 'Suppliers List',
    'add_supplier': 'Add Supplier',

    // Topbar
    'topbar.light': 'Light',
    'topbar.dark': 'Dark',
    'topbar.neon': 'Neon',
    'topbar.mode': 'Mode',
    'topbar.theme': 'Theme',
    'topbar.quick_search': 'Search PRs, POs, quotes...',
    'topbar.notifications': 'Notifications',
    'topbar.unread': 'unread',
    'topbar.language': 'Language',
    'topbar.lang.en': 'English',
    'topbar.lang.id': 'Bahasa Indonesia',
    'topbar.help': 'Help',
    'topbar.theme_toggle': 'Toggle theme',
    'topbar.language_toggle': 'Toggle language',
    'topbar.settings': 'Settings',
    'topbar.logout': 'Logout',
    'topbar.logged_in_as': 'Logged in as {name}',
    'topbar.offline_mock': 'Offline Mock',
    // Added keys for Mode UX banner and labels
    'topbar.operating_as': 'Operating as',
    'mode.buying': 'Buying',
    'mode.selling': 'Selling',
    // Settings additions
    'settings.default_mode': 'Default Mode',
    'settings.default_mode_desc': 'Choose your default operating mode for sign-in and redirects',
    // Admin Dashboard
    'admin.title': 'Admin Dashboard',
    'admin.metrics.pending_quotes': 'Pending Quotes',
    'admin.metrics.active_pos': 'Active POs',
    'admin.metrics.unpaid_invoices': 'Unpaid Invoices',
    'admin.updated_hint': 'Updated 10m ago',
    'admin.comm_center': 'Client Communication Center',
    'admin.compose_email': 'Compose Email',
    'admin.recent_activity': 'Recent Activity',
    'admin.new_pr': 'New PR',
    'admin.new_quote': 'New Quote',
    'admin.new_po': 'New PO',

    // Activity strings
    'activity.created_quote': 'Created Quote {id} for {pr}',
    'activity.approved_po': 'Approved {po}',
    'activity.updated_budget': 'Updated budget for {dept}',

    // Time strings
    'time.today': 'Today',
    'time.yesterday': 'Yesterday',
    'time.hours_ago': '{n}h ago',
    'time.days_ago': '{n}d ago',

    // DataTable common
    'datatable.filter': 'Filter...',
    'datatable.export_csv': 'Export CSV',
    'datatable.export_pdf': 'Export PDF',
    'datatable.client_id': 'Client ID',
    'datatable.company': 'Company',
    'datatable.status': 'Status',
    'datatable.last_contact': 'Last Contact',
    'datatable.bulk_action': 'Bulk Action',
    'datatable.select_all': 'Select all',
    'datatable.prev': 'Prev',
    'datatable.next': 'Next',
    'datatable.page': 'Page',

    // Status values
    'status.active': 'Active',
    'status.pending_quote': 'Pending Quote',
    'status.po_issued': 'PO Issued',
    'status.shipped': 'Shipped',
    'status.unpaid': 'Unpaid',
    'status.processing': 'Processing',
    'status.delivered': 'Delivered',
    'status.invoiced': 'Invoiced',
    'status.paid': 'Paid',
    'status.pr': 'PR',
    'status.quote': 'Quote',
    'status.po': 'PO',

    // Client Dashboard
    'client.quick_pr': 'Quick PR',
    'client.quick_pr_desc': 'Create a purchase request with a few clicks.',
    'client.create_pr': 'Create PR',
    'client.budget_utilization': 'Budget Utilization',
    'client.documents': 'Documents',
    'client.welcome': 'Welcome, {company}',
    'client.order_tracking': 'Order Tracking',
    'client.document_label': 'Document',

    // Onboarding
    'onb.title': 'Corporate Onboarding',
    'onb.steps.company': 'Company',
    'onb.steps.hierarchy': 'Hierarchy',
    'onb.steps.roles': 'Roles',
    'onb.steps.budgets': 'Budgets',
    'onb.company_registration': 'Company Registration',
    'onb.company_name': 'Company Name',
    'onb.domain': 'Email Domain',
    'onb.hierarchy_setup': 'Hierarchy Setup',
    'onb.add_departments': 'Add departments for your organization',
    'onb.new_department': 'New Department',
    'onb.remove_last': 'Remove last',
    'onb.role_permissions': 'Role-based Permissions',
    'onb.select_roles': 'Select applicable roles',
    'onb.role_matrix': 'Permission Matrix',
    'onb.perm.create_pr': 'Create PRs',
    'onb.perm.approve_po': 'Approve POs',
    'onb.perm.manage_budgets': 'Manage Budgets',
    'onb.perm.view_finance': 'View Finance',
    'onb.department_budgets': 'Department Budgets',
    'onb.allocate_budgets': 'Allocate budgets per department',
    'onb.annual_budget': 'Annual Budget (IDR)',
    'onb.budget_allocation': 'Budget Allocation',
    'onb.total_budget': 'Total Budget',
    'onb.remaining': 'Remaining',
    'onb.finish': 'Finish',
    'onb.autosaved': 'Draft autosaved',
    'onb.err_over_budget': 'Allocated exceeds total budget',
    'onb.finish_success': 'Onboarding complete',

    // Document Manager
    'docs.title': 'Document Manager',
    'docs.list': 'Documents',
    'docs.bulk_download': 'Bulk Download',
    'docs.version': 'v{n}',
    'docs.access': 'Access',
    'docs.thumbnail': 'Thumbnail',
    'docs.delete_selected': 'Delete Selected',
    'docs.download': 'Download',
    'docs.selected': 'Selected: {n}',
    'docs.downloading': 'Downloading {n} files...',
    'docs.download_complete': 'Download complete',
    'docs.show_history': 'Show history',
    'docs.hide_history': 'Hide history',
    'docs.version_history': 'Version History',

    // Email Dashboard
    'email.title': 'Email Integration',
    'email.sync_status': 'Sync Status',
    'email.connected': 'Connected',
    'email.disconnected': 'Disconnected',
    'email.sync_desc': 'Two-way sync visualization between app and email. Configure CC/BCC rules per client type and manage templates.',
    'email.templates': 'Templates',
    'email.add_template': 'Add Template',
    'email.new_template': 'New Template',
    'email.name': 'Name',
    'email.subject': 'Subject',
    'email.updated': 'Updated',
    'email.rules': 'CC/BCC Rules',
    'email.client_type': 'Client Type',
    'email.cc': 'CC',
    'email.bcc': 'BCC',
    'email.enabled': 'Enabled',
    'email.toggle_enabled': 'Toggle',
    'email.save_rules': 'Save Rules',

    // Communication Hub
    'comms.title': 'Communication Hub',
    'comms.threads': 'Threads',
    'comms.unread': 'Unread: {n}',
    'comms.input_placeholder': 'Type a message. Use @mentions',
    'comms.to': 'To',
    'comms.cc': 'Cc',
    'comms.bcc': 'Bcc',
    'comms.subject': 'Subject',
    'comms.hint_mentions': 'Use @ to mention participants',
    'comms.email_integration': 'Email Integration',
    'comms.email_sync_desc': 'Two-way sync is visualized here. CC/BCC rules per client type are applied automatically.',
    'comms.connected_to': 'Connected to: {email}',
    'comms.add_attachments': 'Add attachments',
    'comms.attachments': 'Attachments',
    'comms.uploading': 'Uploading...',
    'comms.status.sent': 'Sent',
    'comms.status.delivered': 'Delivered',
    'comms.status.read': 'Read',
    'comms.blocked_banner': 'Messaging disabled: one or more participants are blocked.',

    // Reporting
    'reports.title': 'Reporting',
    'reports.spending_analytics': 'Spending Analytics',
    'reports.vendor_performance': 'Vendor Performance',
    'reports.budget_utilization': 'Budget Utilization',
    // Delivery Notes (Inventory)
    'delivery.title': 'Delivery Notes',
    'delivery.header_desc': 'Confirm receipts and record corrections; invoices must respect corrected quantities.',
    'delivery.po_label': 'PO',
    'delivery.delivered_amount': 'Delivered Amount',
    'delivery.table.item': 'Item',
    'delivery.table.ordered': 'Ordered',
    'delivery.table.shipped': 'Shipped',
    'delivery.table.received': 'Received',
    'delivery.table.correction': 'Correction',
    'delivery.table.available_to_invoice': 'Available to Invoice',
    'delivery.invariant': 'Invariant: sum(delivery.qty) ≤ sum(po.qty). Corrections adjust available-to-invoice quantities; invoices must respect corrected quantities.',
    'delivery.correction_aria': 'Correction for {name}',

    // Reporting (Supplier) — Invoicing Gate
    'reporting.create_invoice': 'Create Invoice',
    'reporting.remaining_deliverable': 'Remaining deliverable',
    'reporting.delivery_references': 'Delivery References',
    'reporting.no_delivery_records': 'No delivery records found for this PO.',
    'reporting.insufficient_delivered_amount': 'Insufficient delivered amount',
    // Reporting — Payment Status Labels
    'reporting.status.paid': 'Paid',
    'reporting.status.over_due': 'Over-due',
    'reporting.status.waiting': 'Waiting payment',
    'reporting.status.next': 'Next payment',
    'reporting.status.neutral': 'Neutral',
    'reports.monthly_procurement': 'Monthly Procurement',
    // Help Center
    'help.title': 'Help Center',
    'help.sub': 'Guides, workflows, and quick links',
    'help.user_guide': 'User Guide',
    'help.user_guide_desc': 'End-to-end walkthrough from PR to Paid.',
    'help.workflows': 'Workflows',
    'help.workflows_desc': 'Lifecycle, guards, and invariants.',
    'help.roles_permissions': 'Roles & Permissions',
    'help.roles_permissions_desc': 'Access matrix and approvals gating.',
    'help.ui_theme_i18n': 'UI Theme & I18N',
    'help.ui_theme_i18n_desc': 'Neon corporate palette and language behavior.',
    'help.faq': 'FAQ',
    'help.faq_desc': 'Common questions and answers.',
    'help.email': 'Email & Communication',
    'help.email_desc': 'Email integration and comms hub overview.',
    'help.reporting': 'Reporting',
    'help.reporting_desc': 'Spending analytics and exports.',
    'help.glossary': 'Glossary',
    'help.glossary_desc': 'Key terms and definitions.',
    'help.copy_en_path': 'Copy EN path',
    'help.copy_id_path': 'Copy ID path',
    'help.quick_actions': 'Quick Actions',
    'help.go_create_pr': 'Create PR',
    'help.go_quote_builder': 'Quote Builder',
    'help.go_po_preview': 'PO Preview',
    'help.go_order_tracker': 'Order Tracker',
    'help.go_reporting': 'Reporting',
    'help.docs_hint': 'Docs are included in the repository under /docs. Use the copy buttons to open them locally.',
    'help.openEnglish': 'Open (EN)',
    'help.openIndonesian': 'Open (ID)',
    'help.searchPlaceholder': 'Search help topics...',
    'help.featuredTopics': 'Featured Topics',
    'help.topicPOConversion': 'Convert Quote → PO',
    'help.topicInvoicing': 'Invoicing & Payments',
    'help.topicLifecycle': 'Procurement Lifecycle',
    'help.back': 'Back',
    'help.toggleLanguage': 'Toggle Language',
    'help.openAlternate': 'Open Alternate Language',
    'help.viewing': 'Viewing',
    'help.loading': 'Loading...',

    
    'order_tracker.title': 'Order Tracker',
    'order_tracker.estimated_delivery': 'Estimated delivery',
    'order_tracker.shipping_info': 'Shipping Information',
    'order_tracker.courier': 'Courier',
    'order_tracker.tracking_no': 'Tracking No',
    'order_tracker.delivery_proof': 'Delivery Proof',
    'order_tracker.drop_hint': 'Drag & drop files here or',
    'order_tracker.view_tracking': 'View tracking',
    'order_tracker.uploading': 'Uploading...',
    'order_tracker.upload_complete': 'Upload complete',
    'order_tracker.remove': 'Remove',
    'time.days': 'days',
    'time.hours': 'hours',
    'time.minutes': 'minutes',
    'action.upload': 'Upload',

    // Gating messages / actions
    'gating.quote_builder_disabled': 'Approve PRs and send to suppliers to build quotes',
    'gating.approval_required_send': 'Only Approved PRs can be sent to suppliers. Please get Finance/Admin approval first.',
    'gating.approval_required_compare': 'Approve PR to compare quotes.',
    'action.compare_quotes': 'Compare quotes',
    'action.send_pr_to_suppliers': 'Send PR to suppliers',
    'action.approve': 'Approve',
    'action.reject': 'Reject',

    // Quote actions & labels
    'action.approve_quote': 'Approve Quote',
    'action.reject_quote': 'Reject Quote',
    'po.generate_from_quote': 'Generate PO',
    'quote.version': 'Version',
    'quote.valid_until': 'Valid Until',
    'status.label': 'Status',
    'actions.label': 'Actions',
    'quotes.title': 'Quote Comparison',
    'quotes.subtitle': 'Compare quotes for PR {pr}',
    'quotes.none_hint': 'No quotes yet. Use "Send PR to suppliers" from PR List, then check back.',
    'quote.approved_alert': 'Approved quote v{version} from {supplier}. You can now generate a PO.',
    'quote.rejected_alert': 'Rejected quote v{version} from {supplier}.',

    // PR List / Create
    'pr.header': 'Purchase Requests',
    'pr.total': 'total',
    'pr.new_pr': 'New PR',
    'pr.id': 'PR ID',
    'pr.title_label': 'Title',
    'pr.department': 'Department',
    'pr.status': 'Status',
    'pr.created': 'Created',
    'pr.details': 'Request Details',
    'pr.items': 'Items',
    'pr.approval_budget': 'Approval & Budget',
    'pr.step_of': 'Step {n} of {max}',
    'pr.files_drop_hint': 'Drag & drop files here or select to upload',
    'pr.uploading': 'Uploading',
    'pr.done': 'Done',
    'pr.item_spec': 'Specification',
    'pr.budget_code': 'Budget Code',
    'pr.approver': 'Approver',
    'pr.autosaved': 'Draft autosaved',
    'pr.submit_success': 'PR submitted successfully',
    'pr.err_title': 'Title is required',
    'pr.err_department': 'Department is required',
    'pr.err_needed_by': 'Needed by date required',
    'pr.err_items': 'At least one item is required',
    'pr.err_item_name': 'Item name required',
    'pr.err_item_qty': 'Quantity must be > 0',
    'pr.err_budget_code': 'Budget code required',
    'pr.err_approver': 'Approver required',

    // Common form labels/actions
    'form.title': 'Title',
    'form.department': 'Department',
    'form.needed_by': 'Needed By',
    'form.description': 'Description',
    'form.attach_files': 'Attach files',
    'form.last_saved': 'Last saved: {time}',
    'action.back': 'Back',
    'action.continue': 'Continue',
    'action.submit_pr': 'Submit PR',
    'action.add_item': 'Add Item',
    'action.remove': 'Remove',
    'action.export': 'Export',
    'action.send': 'Send',

    // Quote Builder
    'quote.items': 'Items',
    'quote.item': 'Item',
    'quote.qty': 'Qty',
    'quote.price': 'Price',
    'quote.total': 'Total',
    'quote.tax_rate': 'Tax Rate (%)',
    'quote.discount': 'Discount (IDR)',
    'quote.template': 'Template',
    'quote.subtotal': 'Subtotal',
    'quote.tax': 'Tax',
    'quote.grand_total': 'Grand Total',
    'action.preview': 'Preview',
    'action.close_preview': 'Close Preview',
    'action.send_quote': 'Send Quote',
    'quote.preview_hint': 'This is a template preview. Content will match selected style.',

    // Invoice Matching
    'invoiceMatching.title': 'Invoice Matching',
    'invoiceMatching.description': '3-way and 4-way invoice matching with OCR processing and exception handling',
    'invoiceMatching.matchings': 'Invoice Matchings',
    'invoiceMatching.manageMatchings': 'Manage invoice matching processes and exceptions',
    'invoiceMatching.search': 'Search invoices...',
    'invoiceMatching.invoiceNumber': 'Invoice Number',
    'invoiceMatching.vendor': 'Vendor',
    'invoiceMatching.matchingType': 'Matching Type',
    'invoiceMatching.status': 'Status',
    'invoiceMatching.matchingScore': 'Matching Score',
    'invoiceMatching.ocrConfidence': 'OCR Confidence',
    'invoiceMatching.exceptions': 'Exceptions',
    'invoiceMatching.allStatuses': 'All Statuses',
    'invoiceMatching.allTypes': 'All Types',
    'invoiceMatching.stats.total': 'Total Matchings',
    'invoiceMatching.stats.pending': 'Pending',
    'invoiceMatching.stats.matched': 'Matched',
    'invoiceMatching.stats.exceptions': 'Exceptions',
    'invoiceMatching.type.2-way': '2-Way',
    'invoiceMatching.type.3-way': '3-Way',
    'invoiceMatching.type.4-way': '4-Way',
    'invoiceMatching.status.pending': 'Pending',
    'invoiceMatching.status.matched': 'Matched',
    'invoiceMatching.status.exception': 'Exception',
    'invoiceMatching.status.rejected': 'Rejected',
    'invoiceMatching.status.approved': 'Approved',

    // Payments
    'payments.title': 'Payments Management',
    'payments.stats.total': 'Total Payments',
    'payments.stats.pending': 'Pending',
    'payments.stats.completed': 'Completed',
    'payments.stats.failed': 'Failed',
    'payments.tab.runs': 'Runs',
    'payments.tab.payments': 'Payments',
    'payments.tab.methods': 'Methods',
    'payments.tab.reconciliation': 'Reconciliation',
    'payments.run_default_name': 'Payment Run',
    'payments.run_name': 'Run Name',
    'payments.run_date': 'Run Date',
    'payments.status': 'Status',
    'payments.total_payments': 'Payments',
    'payments.total_amount': 'Total Amount',
    'payments.payment_reference': 'Payment Ref',
    'payments.invoice': 'Invoice',
    'payments.vendor': 'Vendor',
    'payments.amount': 'Amount',
    'payments.reconciliation_status': 'Reconciliation',
    'payments.method_name': 'Name',
    'payments.method_type': 'Type',
    'payments.currency': 'Currency',
    'payments.active': 'Active',
    'payments.default': 'Default',
    'payments.bank_statement': 'Bank Statement',
    'payments.bank_transactions': 'Bank Transactions',
    'payments.unreconciled_payments': 'Unreconciled Payments',
    'payments.date': 'Date',
    'payments.description': 'Description',
    'payments.reference': 'Reference',
    'payments.actions.create_run': 'Create Run',
    'payments.actions.schedule': 'Schedule',
    'payments.actions.approve': 'Approve',
    'payments.actions.execute': 'Execute',
    'payments.actions.add_method': 'Add Method',
    'payments.actions.enable': 'Enable',
    'payments.actions.disable': 'Disable',
    'payments.actions.delete': 'Delete',
    'payments.actions.match': 'Match',
    'supplierOnboarding.title': 'Supplier Onboarding',
    'supplierOnboarding.applications': 'Applications',
    'supplierOnboarding.kycDocuments': 'KYC Documents',
    'supplierOnboarding.complianceChecks': 'Compliance Checks',
    'supplierOnboarding.riskScoring': 'Risk Scoring',
    'supplierOnboarding.status': 'Status',
    'supplierOnboarding.vendor': 'Vendor',
    'supplierOnboarding.risk_score': 'Risk Score',
    'supplierOnboarding.actions.create': 'Create',
    'supplierOnboarding.actions.submit': 'Submit',
    'supplierOnboarding.actions.approve': 'Approve',
    'supplierOnboarding.actions.reject': 'Reject',
    'supplierOnboarding.actions.upload': 'Upload',
    'supplierOnboarding.actions.run': 'Run',

    // ERP Connectors
    'erp_connectors.title': 'ERP Connectors',
    'erp_connectors.stats.total': 'Total Connectors',
    'erp_connectors.stats.connected': 'Connected',
    'erp_connectors.stats.active': 'Active',
    'erp_connectors.stats.with_errors': 'With Errors',
    'erp_connectors.select_connector': 'Select Connector',
    'erp_connectors.tabs.connectors': 'Connectors',
    'erp_connectors.tabs.webhooks': 'Webhooks',
    'erp_connectors.tabs.sync_jobs': 'Sync Jobs',
    'erp_connectors.tabs.logs': 'Logs',
    'erp_connectors.name': 'Name',
    'erp_connectors.type': 'Type',
    'erp_connectors.description': 'Description',
    'erp_connectors.base_url': 'Base URL',
    'erp_connectors.api_version': 'API Version',
    'erp_connectors.auth_type': 'Auth Type',
    'erp_connectors.auth_config': 'Auth Config',
    'erp_connectors.sync_frequency': 'Sync Frequency',
    'erp_connectors.sync_direction': 'Sync Direction',
    'erp_connectors.last_sync': 'Last Sync',
    'erp_connectors.error_count': 'Error Count',
    'erp_connectors.status.connected': 'Connected',
    'erp_connectors.status.disconnected': 'Disconnected',
    'erp_connectors.status.error': 'Error',
    'erp_connectors.status.testing': 'Testing',
    'erp_connectors.frequency.manual': 'Manual',
    'erp_connectors.frequency.hourly': 'Hourly',
    'erp_connectors.frequency.daily': 'Daily',
    'erp_connectors.frequency.weekly': 'Weekly',
    'erp_connectors.frequency.monthly': 'Monthly',
    'erp_connectors.add_connector': 'Add Connector',
    'erp_connectors.test_connection': 'Test Connection',
    'erp_connectors.webhooks': 'Webhooks',
    'erp_connectors.event_type': 'Event Type',
    'erp_connectors.method': 'Method',
    'erp_connectors.success_rate': 'Success Rate',
    'erp_connectors.last_triggered': 'Last Triggered',
    'erp_connectors.add_webhook': 'Add Webhook',
    'erp_connectors.sync_jobs': 'Sync Jobs',
    'erp_connectors.job_type': 'Job Type',
    'erp_connectors.entity_type': 'Entity Type',
    'erp_connectors.sync_status.pending': 'Pending',
    'erp_connectors.sync_status.running': 'Running',
    'erp_connectors.sync_status.completed': 'Completed',
    'erp_connectors.sync_status.failed': 'Failed',
    'erp_connectors.sync_status.cancelled': 'Cancelled',
    'erp_connectors.progress': 'Progress',
    'erp_connectors.started_at': 'Started At',
    'erp_connectors.add_sync_job': 'Add Sync Job',
    'erp_connectors.execute': 'Execute',
    'erp_connectors.logs': 'Logs',
    'erp_connectors.log_type.info': 'Info',
    'erp_connectors.log_type.warning': 'Warning',
    'erp_connectors.log_type.error': 'Error',
    'erp_connectors.log_type.debug': 'Debug',
    'erp_connectors.headers': 'Headers',
    'erp_connectors.payload_template': 'Payload Template',
    'erp_connectors.endpoint_url': 'Endpoint URL',
    'nav.erp_connectors': 'ERP Connectors',
    'nav.realtime': 'Real-time Updates',

    // Real-time Updates
    'admin.realtime.title': 'Real-time Manager',
    'admin.realtime.total_connections': 'Total Connections',
    'admin.realtime.connected': 'Connected',
    'admin.realtime.total_messages': 'Total Messages',
    'admin.realtime.total_events': 'Total Events',
    'admin.realtime.active_subscriptions': 'Active Subscriptions',
    'admin.realtime.active': 'Active',
    'admin.realtime.last_24h': 'Last 24h',
    'admin.realtime.processed': 'Processed',
    'admin.realtime.connections': 'Connections',
    'admin.realtime.messages': 'Messages',
    'admin.realtime.events': 'Events',
    'admin.realtime.subscriptions': 'Subscriptions',
    'admin.realtime.connection_name': 'Connection Name',
    'admin.realtime.connection_type': 'Connection Type',
    'admin.realtime.connection_url': 'Connection URL',
    'admin.realtime.status': 'Status',
    'admin.realtime.last_activity': 'Last Activity',
    'admin.realtime.channel': 'Channel',
    'admin.realtime.payload': 'Payload',
    'admin.realtime.timestamp': 'Timestamp',
    'admin.realtime.event_type': 'Event Type',
    'admin.realtime.source': 'Source',
    'admin.realtime.data': 'Data',
    'admin.realtime.event_distribution': 'Event Distribution',
    'admin.realtime.message_volume': 'Message Volume',
    'admin.realtime.new_connection': 'New Connection',
    'admin.realtime.create_connection': 'Create Connection',
    'admin.realtime.send_message': 'Send Message',
    'admin.realtime.send': 'Send',
    'admin.realtime.subscribe': 'Subscribe',
    'admin.realtime.created': 'Created',
    'admin.realtime.module_not_available': 'Real-time module not available',

    // Document Integrations
    'document_integrations.title': 'Document Integrations',
    'document_integrations.stats.total_integrations': 'Total Integrations',
    'document_integrations.stats.connected': 'Connected',
    'document_integrations.stats.total_files': 'Total Files',
    'document_integrations.stats.storage_used': 'Storage Used',
    'document_integrations.select_integration': 'Select Integration',
    'document_integrations.tabs.integrations': 'Integrations',
    'document_integrations.tabs.sync_jobs': 'Sync Jobs',
    'document_integrations.tabs.versions': 'Versions',
    'document_integrations.tabs.ocr': 'OCR',
    'document_integrations.name': 'Name',
    'document_integrations.type': 'Type',
    'document_integrations.description': 'Description',
    'document_integrations.connection_config': 'Connection Config',
    'document_integrations.sync_config': 'Sync Config',
    'document_integrations.sync_frequency': 'Sync Frequency',
    'document_integrations.sync_direction': 'Sync Direction',
    'document_integrations.last_sync': 'Last Sync',
    'document_integrations.folder_mappings': 'Folder Mappings',
    'document_integrations.conflict_resolution': 'Conflict Resolution',
    'document_integrations.files_synced': 'Files Synced',
    'document_integrations.add_integration': 'Add Integration',
    'document_integrations.test_connection': 'Test Connection',
    'document_integrations.sync_jobs': 'Sync Jobs',
    'document_integrations.job_type': 'Job Type',
    'document_integrations.direction': 'Direction',
    'document_integrations.status': 'Status',
    'document_integrations.progress': 'Progress',
    'document_integrations.files': 'Files',
    'document_integrations.started_at': 'Started At',
    'document_integrations.add_sync_job': 'Add Sync Job',
    'document_integrations.execute': 'Execute',
    'document_integrations.document_versions': 'Document Versions',
    'document_integrations.file_name': 'File Name',
    'document_integrations.file_size': 'File Size',
    'document_integrations.mime_type': 'MIME Type',
    'document_integrations.sync_status': 'Sync Status',
    'document_integrations.versions': 'Versions',
    'document_integrations.last_modified': 'Last Modified',
    'document_integrations.version_status.synced': 'Synced',
    'document_integrations.version_status.pending': 'Pending',
    'document_integrations.version_status.conflict': 'Conflict',
    'document_integrations.version_status.error': 'Error',
    'document_integrations.ocr_results': 'OCR Results',
    'document_integrations.document_id': 'Document ID',
    'document_integrations.ocr_provider': 'OCR Provider',
    'document_integrations.confidence': 'Confidence',
    'document_integrations.processing_time': 'Processing Time',
    'document_integrations.view_data': 'View Data',
    'document_integrations.frequency.manual': 'Manual',
    'document_integrations.frequency.hourly': 'Hourly',
    'document_integrations.frequency.daily': 'Daily',
    'document_integrations.frequency.weekly': 'Weekly',
    'document_integrations.direction.inbound': 'Inbound',
    'document_integrations.direction.outbound': 'Outbound',
    'document_integrations.direction.bidirectional': 'Bidirectional',
    'document_integrations.status.connected': 'Connected',
    'document_integrations.status.disconnected': 'Disconnected',
    'document_integrations.status.error': 'Error',
    'document_integrations.status.syncing': 'Syncing',
    'document_integrations.sync_status.pending': 'Pending',
    'document_integrations.sync_status.running': 'Running',
    'document_integrations.sync_status.completed': 'Completed',
    'document_integrations.sync_status.failed': 'Failed',
    'document_integrations.sync_status.cancelled': 'Cancelled',
    'document_integrations.ocr_status.pending': 'Pending',
    'document_integrations.ocr_status.processing': 'Processing',
    'document_integrations.ocr_status.completed': 'Completed',
    'document_integrations.ocr_status.failed': 'Failed',
    'nav.document_integrations': 'Document Integrations',
  },
  id: {
    // Auth / Login
    'auth.login_title': 'Masuk ke MPSOne',
    'auth.login_subtitle': 'Suite pengadaan enterprise untuk perusahaan tambang Kalimantan',
    'auth.email': 'Email',
    'auth.password': 'Kata Sandi',
    'auth.password_placeholder': 'Masukkan kata sandi',
    'auth.remember_me': 'Ingat saya',
    'auth.forgot_password': 'Lupa kata sandi?',
    'auth.role': 'Masuk sebagai',
    'auth.role_hint': 'Hak akses berbasis peran: Admin, PIC Operasional, PIC Procurement, PIC Finance',
    'auth.sign_in': 'Masuk',
    'auth.or': 'atau',
    'auth.sso': 'Masuk dengan SSO',
    'auth.sso_hint': 'Placeholder integrasi SSO (Azure AD / Google Workspace)',
    'auth.security_notice': 'Keamanan: WCAG AA, formulir aman, dan rute terlindungi',
    'auth.version': 'Versi {v}',
    'auth.login_success': 'Selamat datang {email}',
    'auth.error_email': 'Harap masukkan alamat email yang valid',
    'auth.error_password': 'Kata sandi minimal 6 karakter',
    'auth.choose_who': 'Anda siapa?',
    'auth.i_am_supplier': 'Saya Supplier',
    'auth.i_am_client': 'Saya Klien',
    'auth.role_explain': 'Supplier masuk sebagai Admin. Klien memilih peran PIC.',
    'auth.mode_supplier': 'Mode Supplier dipilih',
    'auth.mode_client': 'Mode Klien dipilih',
    'auth.supplier_admin_assumed': 'Akses Admin Supplier diasumsikan untuk lingkungan ini',
    'auth.use_code': 'Masuk dengan Kode',
    'auth.join_with_code_hint': 'Masukkan kode akses dari admin untuk konfigurasi otomatis akun Anda.',
    'auth.code_invalid': 'Kode tidak valid',
    'auth.code_success': 'Akses diberikan',
    'auth.code_number': 'Nomor kode',
    'auth.continue': 'Lanjut',
    'department.name': 'Departemen',
    'clipboard.copied': 'Disalin',

    // Role descriptions
    'roles.pic_operational_desc': 'Penerimaan harian, konfirmasi pengiriman, koreksi surat jalan.',
    'roles.pic_procurement_desc': 'Pembuatan PR, penawaran pemasok, pembuatan PO, koordinasi vendor.',
    'roles.pic_finance_desc': 'Verifikasi tagihan, penjadwalan pembayaran, pelacakan status pembayaran.',

    // Admin invites
    'admin.invite_user': 'Undang Pengguna',
    'admin.invites.title': 'Kelola Undangan',
    'admin.invites.none': 'Belum ada undangan.',
    'admin.invites.code': 'Kode',
    'admin.invites.expires_at': 'Kedaluwarsa',
    'admin.invites.status': 'Status',
    'admin.invites.revoke': 'Batalkan',
    // Approval Workflows
    'approval_workflow.title': 'Alur Persetujuan',
    'approval_workflow.subtitle': 'Manajemen Alur Persetujuan',
    'approval_workflow.description': 'Konfigurasikan proses persetujuan multi-level dengan SLA dan aturan eskalasi',
    'approval_workflow.create_workflow': 'Buat Alur Kerja',
    'approval_workflow.edit_workflow': 'Edit Alur Kerja',
    'approval_workflow.workflow_name': 'Nama Alur Kerja',
    'approval_workflow.document_type': 'Jenis Dokumen',
    'approval_workflow.department': 'Departemen',
    'approval_workflow.amount_range': 'Rentang Jumlah',
    'approval_workflow.steps': 'Langkah',
    'approval_workflow.sla': 'SLA',
    'approval_workflow.status': 'Status',
    'approval_workflow.active': 'Aktif',
    'approval_workflow.inactive': 'Tidak Aktif',
    'approval_workflow.min_amount': 'Jumlah Minimum',
    'approval_workflow.max_amount': 'Jumlah Maksimum',
    'approval_workflow.total_workflows': 'Total Alur Kerja',
    // General
    'general.home': 'Beranda',

    // Navigation
    'nav.admin_dashboard': 'Dasbor Admin',
    'nav.client_dashboard': 'Dasbor Klien',
    'nav.onboarding': 'Onboarding Perusahaan',
    'nav.purchase_requests': 'Permintaan Pembelian',
    'nav.quote_builder': 'Pembuat Penawaran',
    'nav.order_tracker': 'Pelacak Pesanan',
    'nav.docs': 'Manajer Dokumen',
    'nav.comms': 'Pusat Komunikasi',
    'nav.email_dashboard': 'Dasbor Email',
    'nav.reporting': 'Laporan',
    'nav.help': 'Pusat Bantuan',
    'nav.people': 'Orang',
    'nav.invitations': 'Undangan',
    'nav.approval_workflows': 'Alur Kerja Persetujuan',
    'nav.departmental_budgets': 'Anggaran Departemen',
    'nav.contracts': 'Kontrak',
    'nav.invoice_matching': 'Pencocokan Faktur',
    'nav.supplier_onboarding': 'Onboarding Supplier',

    // Topbar
    'topbar.light': 'Terang',
    'topbar.dark': 'Gelap',
    'topbar.neon': 'Neon',
    'topbar.mode': 'Mode',
    'topbar.theme': 'Tema',
    'topbar.quick_search': 'Cari PR, PO, penawaran...',
    'topbar.notifications': 'Notifikasi',
    'topbar.unread': 'belum dibaca',
    'topbar.language': 'Bahasa',
    'topbar.lang.en': 'English',
    'topbar.lang.id': 'Bahasa Indonesia',
    'topbar.help': 'Bantuan',
    'topbar.theme_toggle': 'Ganti tema',
    'topbar.language_toggle': 'Ganti bahasa',
    'topbar.settings': 'Pengaturan',
    'topbar.logout': 'Keluar',
    'topbar.logged_in_as': 'Masuk sebagai {name}',
    'topbar.offline_mock': 'Mock Offline',
    // Added keys for Mode UX banner and labels
    'topbar.operating_as': 'Beroperasi sebagai',
    'mode.buying': 'Pembelian',
    'mode.selling': 'Penjualan',
    // Settings additions
    'settings.default_mode': 'Mode Default',
    'settings.default_mode_desc': 'Pilih mode operasi default untuk masuk dan pengalihan',
    // Admin Dashboard
    'admin.title': 'Dasbor Admin',
    'admin.metrics.pending_quotes': 'Penawaran Tertunda',
    'admin.metrics.active_pos': 'PO Aktif',
    'admin.metrics.unpaid_invoices': 'Tagihan Belum Dibayar',
    'admin.updated_hint': 'Diperbarui 10m lalu',
    'admin.comm_center': 'Pusat Komunikasi Klien',
    'admin.compose_email': 'Tulis Email',
    'admin.recent_activity': 'Aktivitas Terbaru',
    'admin.new_pr': 'PR Baru',
    'admin.new_quote': 'Penawaran Baru',
    'admin.new_po': 'PO Baru',

    // Activity strings
    'activity.created_quote': 'Membuat Penawaran {id} untuk {pr}',
    'activity.approved_po': 'Menyetujui {po}',
    'activity.updated_budget': 'Memperbarui anggaran untuk {dept}',

    // Time strings
    'time.today': 'Hari ini',
    'time.yesterday': 'Kemarin',
    'time.hours_ago': '{n}j lalu',
    'time.days_ago': '{n} hari lalu',
    'time.days': 'hari',

    // DataTable common
    'datatable.filter': 'Filter...',
    'datatable.export_csv': 'Ekspor CSV',
    'datatable.export_pdf': 'Ekspor PDF',
    'datatable.client_id': 'ID Klien',
    'datatable.company': 'Perusahaan',
    'datatable.status': 'Status',
    'datatable.last_contact': 'Kontak Terakhir',
    'datatable.bulk_action': 'Aksi Massal',
    'datatable.select_all': 'Pilih semua',
    'datatable.prev': 'Sebelumnya',
    'datatable.next': 'Berikutnya',
    'datatable.page': 'Halaman',

    // Status values
    'status.active': 'Aktif',
    'status.pending_quote': 'Menunggu Penawaran',
    'status.po_issued': 'PO Diterbitkan',
    'status.shipped': 'Dikirim',
    'status.unpaid': 'Belum Dibayar',
    'status.processing': 'Diproses',
    'status.delivered': 'Terkirim',
    'status.invoiced': 'Ditagihkan',
    'status.paid': 'Dibayar',
    'status.pr': 'PR',
    'status.quote': 'Penawaran',
    'status.po': 'PO',

    // Client Dashboard
    'client.quick_pr': 'PR Cepat',
    'client.quick_pr_desc': 'Buat PR hanya dengan beberapa klik.',
    'client.create_pr': 'Buat PR',
    'client.budget_utilization': 'Penggunaan Anggaran',
    'client.documents': 'Dokumen',
    'client.welcome': 'Selamat datang, {company}',
    'client.order_tracking': 'Pelacakan Pesanan',
    'client.document_label': 'Dokumen',

    // Onboarding
    'onb.title': 'Onboarding Perusahaan',
    'onb.steps.company': 'Perusahaan',
    'onb.steps.hierarchy': 'Hierarki',
    'onb.steps.roles': 'Peran',
    'onb.steps.budgets': 'Anggaran',
    'onb.company_registration': 'Registrasi Perusahaan',
    'onb.company_name': 'Nama Perusahaan',
    'onb.domain': 'Domain Email',
    'onb.hierarchy_setup': 'Pengaturan Hierarki',
    'onb.add_departments': 'Tambahkan departemen untuk organisasi Anda',
    'onb.new_department': 'Departemen Baru',
    'onb.remove_last': 'Hapus terakhir',
    'onb.role_permissions': 'Hak Akses Berbasis Peran',
    'onb.select_roles': 'Pilih peran yang berlaku',
    'onb.role_matrix': 'Matriks Hak Akses',
    'onb.perm.create_pr': 'Buat PR',
    'onb.perm.approve_po': 'Setujui PO',
    'onb.perm.manage_budgets': 'Kelola Anggaran',
    'onb.perm.view_finance': 'Lihat Keuangan',
    'onb.department_budgets': 'Anggaran Departemen',
    'onb.allocate_budgets': 'Alokasikan anggaran per departemen',
    'onb.annual_budget': 'Anggaran Tahunan (IDR)',
    'onb.budget_allocation': 'Alokasi Anggaran',
    'onb.total_budget': 'Total Anggaran',
    'onb.remaining': 'Sisa',
    'onb.finish': 'Selesai',
    'onb.autosaved': 'Draf tersimpan otomatis',
    'onb.err_over_budget': 'Alokasi melebihi total anggaran',
    'onb.finish_success': 'Onboarding selesai',

    // Document Manager
    'docs.title': 'Manajer Dokumen',
    'docs.list': 'Dokumen',
    'docs.bulk_download': 'Unduh Massal',
    'docs.version': 'v{n}',
    'docs.access': 'Akses',
    'docs.thumbnail': 'Gambar mini',
    'docs.delete_selected': 'Hapus Terpilih',
    'docs.download': 'Unduh',
    'docs.selected': 'Terpilih: {n}',
    'docs.downloading': 'Mengunduh {n} berkas...',
    'docs.download_complete': 'Unduh selesai',
    'docs.show_history': 'Tampilkan riwayat',
    'docs.hide_history': 'Sembunyikan riwayat',
    'docs.version_history': 'Riwayat Versi',

    // Email Dashboard
    'email.title': 'Integrasi Email',
    'email.sync_status': 'Status Sinkronisasi',
    'email.connected': 'Terhubung',
    'email.disconnected': 'Tidak Terhubung',
    'email.sync_desc': 'Visualisasi sinkronisasi dua-arah antara aplikasi dan email. Atur CC/BCC per tipe klien dan kelola templat.',
    'email.templates': 'Templat',
    'email.add_template': 'Tambah Templat',
    'email.new_template': 'Templat Baru',
    'email.name': 'Nama',
    'email.subject': 'Subjek',
    'email.updated': 'Diperbarui',
    'email.rules': 'Aturan CC/BCC',
    'email.client_type': 'Tipe Klien',
    'email.cc': 'CC',
    'email.bcc': 'BCC',
    'email.enabled': 'Aktif',
    'email.toggle_enabled': 'Ubah',
    'email.save_rules': 'Simpan Aturan',

    // Communication Hub
    'comms.title': 'Pusat Komunikasi',
    'comms.threads': 'Thread',
    'comms.unread': 'Belum dibaca: {n}',
    'comms.input_placeholder': 'Ketik pesan. Gunakan @mention',
    'comms.to': 'Kepada',
    'comms.cc': 'Cc',
    'comms.bcc': 'Bcc',
    'comms.subject': 'Subjek',
    'comms.hint_mentions': 'Gunakan @ untuk menyebut peserta',
    'comms.email_integration': 'Integrasi Email',
    'comms.email_sync_desc': 'Sinkronisasi dua-arah divisualisasikan di sini. Aturan CC/BCC per tipe klien diterapkan otomatis.',
    'comms.connected_to': 'Terhubung ke: {email}',
    'comms.add_attachments': 'Tambah lampiran',
    'comms.attachments': 'Lampiran',
    'comms.uploading': 'Mengunggah...',
    'comms.status.sent': 'Terkirim',
    'comms.status.delivered': 'Tersampaikan',
    'comms.status.read': 'Dibaca',
    'comms.blocked_banner': 'Mengirim pesan dinonaktifkan: satu atau lebih peserta diblokir.',

    // Reporting
    'reports.title': 'Laporan',
    'reports.spending_analytics': 'Analitik Pengeluaran',
    'reports.vendor_performance': 'Performa Vendor',
    'reports.budget_utilization': 'Pemanfaatan Anggaran',
    'reports.monthly_procurement': 'Pengadaan Bulanan',
    // Catatan Pengiriman (Inventory)
    'delivery.title': 'Catatan Pengiriman',
    'delivery.header_desc': 'Konfirmasi penerimaan dan catat koreksi; faktur harus mengikuti jumlah yang telah dikoreksi.',
    'delivery.po_label': 'PO',
    'delivery.delivered_amount': 'Jumlah Terkirim',
    'delivery.table.item': 'Item',
    'delivery.table.ordered': 'Dipesan',
    'delivery.table.shipped': 'Dikirim',
    'delivery.table.received': 'Diterima',
    'delivery.table.correction': 'Koreksi',
    'delivery.table.available_to_invoice': 'Tersedia untuk Penagihan',
    'delivery.invariant': 'Invariant: jumlah(qty pengiriman) ≤ jumlah(qty PO). Koreksi menyesuaikan jumlah tersedia untuk penagihan; faktur harus mengikuti jumlah yang dikoreksi.',
    'delivery.correction_aria': 'Koreksi untuk {name}',

    // Pelaporan (Supplier) — Gerbang Penagihan
    'reporting.create_invoice': 'Buat Faktur',
    'reporting.remaining_deliverable': 'Sisa yang dapat ditagihkan',
    'reporting.delivery_references': 'Referensi Pengiriman',
    'reporting.no_delivery_records': 'Tidak ada catatan pengiriman untuk PO ini.',
    'reporting.insufficient_delivered_amount': 'Jumlah terkirim tidak mencukupi',
    // Pelaporan — Label Status Pembayaran
    'reporting.status.paid': 'Dibayar',
    'reporting.status.over_due': 'Terlambat',
    'reporting.status.waiting': 'Menunggu pembayaran',
    'reporting.status.next': 'Pembayaran berikutnya',
    'reporting.status.neutral': 'Netral',
    // Help Center
    'help.title': 'Pusat Bantuan',
    'help.sub': 'Panduan, alur kerja, dan tautan cepat',
    'help.user_guide': 'Panduan Pengguna',
    'help.user_guide_desc': 'Langkah lengkap dari PR hingga Paid.',
    'help.workflows': 'Alur Kerja',
    'help.workflows_desc': 'Lifecycle, penjaga, dan invariants.',
    'help.roles_permissions': 'Peran & Hak Akses',
    'help.roles_permissions_desc': 'Matriks akses dan persetujuan.',
    'help.ui_theme_i18n': 'Tema UI & I18N',
    'help.ui_theme_i18n_desc': 'Palet neon korporat dan perilaku bahasa.',
    'help.faq': 'FAQ',
    'help.faq_desc': 'Pertanyaan umum dan jawaban.',
    'help.email': 'Email & Komunikasi',
    'help.email_desc': 'Integrasi email dan ringkasan pusat komunikasi.',
    'help.reporting': 'Pelaporan',
    'help.reporting_desc': 'Analitik pengeluaran dan ekspor.',
    'help.glossary': 'Glosarium',
    'help.glossary_desc': 'Istilah kunci dan definisi.',
    'help.copy_en_path': 'Salin path EN',
    'help.copy_id_path': 'Salin path ID',
    'help.quick_actions': 'Tindakan Cepat',
    'help.go_create_pr': 'Buat PR',
    'help.go_quote_builder': 'Pembuat Penawaran',
    'help.go_po_preview': 'Pratinjau PO',
    'help.go_order_tracker': 'Pelacak Pesanan',
    'help.go_reporting': 'Laporan',
    'help.docs_hint': 'Dokumen ada di repositori bawah /docs. Gunakan tombol salin untuk membukanya secara lokal.',
    'help.openEnglish': 'Buka (EN)',
    'help.openIndonesian': 'Buka (ID)',
    'help.searchPlaceholder': 'Cari topik bantuan...',
    'help.featuredTopics': 'Topik Unggulan',
    'help.topicPOConversion': 'Konversi Quote → PO',
    'help.topicInvoicing': 'Penagihan & Pembayaran',
    'help.topicLifecycle': 'Lifecycle Pengadaan',
    'help.back': 'Kembali',
    'help.toggleLanguage': 'Ganti Bahasa',
    'help.openAlternate': 'Buka Bahasa Alternatif',
    'help.viewing': 'Melihat',
    'help.loading': 'Memuat...',

    
    'order_tracker.title': 'Pelacak Pesanan',
    'order_tracker.estimated_delivery': 'Perkiraan pengiriman',
    'order_tracker.shipping_info': 'Informasi Pengiriman',
    'order_tracker.courier': 'Kurir',
    'order_tracker.tracking_no': 'No Pelacakan',
    'order_tracker.delivery_proof': 'Bukti Pengiriman',
    'order_tracker.drop_hint': 'Tarik & letakkan berkas di sini atau',
    'order_tracker.view_tracking': 'Lihat pelacakan',
    'order_tracker.uploading': 'Mengunggah...',
    'order_tracker.upload_complete': 'Unggah selesai',
    'order_tracker.remove': 'Hapus',
    'time.hours': 'jam',
    'time.minutes': 'menit',

    // PR List / Create
    'pr.header': 'Permintaan Pembelian',
    'pr.total': 'total',
    'pr.new_pr': 'PR Baru',
    'pr.id': 'ID PR',
    'pr.title_label': 'Judul',
    'pr.department': 'Departemen',
    'pr.status': 'Status',
    'pr.created': 'Dibuat',
    'pr.details': 'Detail Permintaan',
    'pr.items': 'Item',
    'pr.approval_budget': 'Persetujuan & Anggaran',
    'pr.step_of': 'Langkah {n} dari {max}',
    'pr.files_drop_hint': 'Tarik & letakkan berkas di sini atau pilih untuk unggah',
    'pr.uploading': 'Mengunggah',
    'pr.done': 'Selesai',
    'pr.item_spec': 'Spesifikasi',
    'pr.budget_code': 'Kode Anggaran',
    'pr.approver': 'Penyetuju',
    'pr.autosaved': 'Draf tersimpan otomatis',
    'pr.submit_success': 'PR berhasil dikirim',
    'pr.err_title': 'Judul wajib diisi',
    'pr.err_department': 'Departemen wajib diisi',
    'pr.err_needed_by': 'Tanggal dibutuhkan wajib diisi',
    'pr.err_items': 'Minimal satu item wajib ada',
    'pr.err_item_name': 'Nama item wajib diisi',
    'pr.err_item_qty': 'Jumlah harus > 0',
    'pr.err_budget_code': 'Kode anggaran wajib diisi',
    'pr.err_approver': 'Penyetuju wajib diisi',

    // Common form labels/actions
    'form.title': 'Judul',
    'form.department': 'Departemen',
    'form.needed_by': 'Dibutuhkan Pada',
    'form.description': 'Deskripsi',
    'form.attach_files': 'Lampirkan berkas',
    'form.last_saved': 'Terakhir disimpan: {time}',
    'action.back': 'Kembali',
    'action.continue': 'Lanjut',
    'action.submit_pr': 'Kirim PR',
    'action.add_item': 'Tambah Item',
    'action.remove': 'Hapus',
    'action.export': 'Ekspor',
    'action.send': 'Kirim',

    // Quote Builder
    'quote.items': 'Item',
    'quote.item': 'Item',
    'quote.qty': 'Qty',
    'quote.price': 'Harga',
    'quote.total': 'Total',
    'quote.tax_rate': 'Pajak (%)',
    'quote.discount': 'Diskon (IDR)',
    'quote.template': 'Templat',
    'quote.subtotal': 'Subtotal',
    'quote.tax': 'Pajak',
    'quote.grand_total': 'Total Akhir',
    'action.preview': 'Pratinjau',
    'action.close_preview': 'Tutup Pratinjau',
    'action.send_quote': 'Kirim Penawaran',
    'quote.preview_hint': 'Ini adalah pratinjau templat. Konten akan mengikuti gaya terpilih.',

    // Invoice Matching
    'invoiceMatching.title': 'Pencocokan Faktur',
    'invoiceMatching.description': 'Pencocokan faktur 3-way dan 4-way dengan pemrosesan OCR dan penanganan pengecualian',
    'invoiceMatching.matchings': 'Pencocokan Faktur',
    'invoiceMatching.manageMatchings': 'Kelola proses pencocokan faktur dan pengecualian',
    'invoiceMatching.search': 'Cari faktur...',
    'invoiceMatching.invoiceNumber': 'Nomor Faktur',
    'invoiceMatching.vendor': 'Vendor',
    'invoiceMatching.matchingType': 'Tipe Pencocokan',
    'invoiceMatching.status': 'Status',
    'invoiceMatching.matchingScore': 'Skor Pencocokan',
    'invoiceMatching.ocrConfidence': 'Kepercayaan OCR',
    'invoiceMatching.exceptions': 'Pengecualian',
    'invoiceMatching.allStatuses': 'Semua Status',
    'invoiceMatching.allTypes': 'Semua Tipe',
    'invoiceMatching.stats.total': 'Total Pencocokan',
    'invoiceMatching.stats.pending': 'Tertunda',
    'invoiceMatching.stats.matched': 'Tercocokkan',
    'invoiceMatching.stats.exceptions': 'Pengecualian',
    'invoiceMatching.type.2-way': '2-Arah',
    'invoiceMatching.type.3-way': '3-Arah',
    'invoiceMatching.type.4-way': '4-Arah',
    'invoiceMatching.status.pending': 'Tertunda',
    'invoiceMatching.status.matched': 'Tercocokkan',
    'invoiceMatching.status.exception': 'Pengecualian',
    'invoiceMatching.status.rejected': 'Ditolak',
    'invoiceMatching.status.approved': 'Disetujui',

    // Payments
    'nav.payments': 'Pembayaran',
    'nav.suppliers': 'Supplier',
    'suppliers_manager': 'Manajer Supplier',
    'suppliers_list': 'Daftar Supplier',
    'add_supplier': 'Tambah Supplier',
    'payments.title': 'Manajemen Pembayaran',
    'payments.stats.total': 'Total Pembayaran',
    'payments.stats.pending': 'Tertunda',
    'payments.stats.completed': 'Selesai',
    'payments.stats.failed': 'Gagal',
    'payments.tab.runs': 'Run',
    'payments.tab.payments': 'Pembayaran',
    'payments.tab.methods': 'Metode',
    'payments.tab.reconciliation': 'Rekonsiliasi',
    'payments.run_default_name': 'Run Pembayaran',
    'payments.run_name': 'Nama Run',
    'payments.run_date': 'Tanggal Run',
    'payments.status': 'Status',
    'payments.total_payments': 'Jumlah',
    'payments.total_amount': 'Total',
    'payments.payment_reference': 'Ref Pembayaran',
    'payments.invoice': 'Faktur',
    'payments.vendor': 'Vendor',
    'payments.amount': 'Jumlah',
    'payments.reconciliation_status': 'Rekonsiliasi',
    'payments.method_name': 'Nama',
    'payments.method_type': 'Tipe',
    'payments.currency': 'Mata Uang',
    'payments.active': 'Aktif',
    'payments.default': 'Default',
    'payments.bank_statement': 'Rekening Koran',
    'payments.bank_transactions': 'Transaksi Bank',
    'payments.unreconciled_payments': 'Pembayaran Belum Direkonsiliasi',
    'payments.date': 'Tanggal',
    'payments.description': 'Deskripsi',
    'payments.reference': 'Referensi',
    'payments.actions.create_run': 'Buat Run',
    'payments.actions.schedule': 'Jadwalkan',
    'payments.actions.approve': 'Setujui',
    'payments.actions.execute': 'Eksekusi',
    'payments.actions.add_method': 'Tambah Metode',
    'payments.actions.enable': 'Aktifkan',
    'payments.actions.disable': 'Nonaktifkan',
    'payments.actions.delete': 'Hapus',
    'payments.actions.match': 'Cocokkan',
    'supplierOnboarding.title': 'Onboarding Supplier',
    'supplierOnboarding.applications': 'Aplikasi',
    'supplierOnboarding.kycDocuments': 'Dokumen KYC',
    'supplierOnboarding.complianceChecks': 'Pemeriksaan Kepatuhan',
    'supplierOnboarding.riskScoring': 'Penilaian Risiko',
    'supplierOnboarding.status': 'Status',
    'supplierOnboarding.vendor': 'Vendor',
    'supplierOnboarding.risk_score': 'Skor Risiko',
    'supplierOnboarding.actions.create': 'Buat',
    'supplierOnboarding.actions.submit': 'Kirim',
    'supplierOnboarding.actions.approve': 'Setujui',
    'supplierOnboarding.actions.reject': 'Tolak',
    'supplierOnboarding.actions.upload': 'Unggah',
    'supplierOnboarding.actions.run': 'Jalankan',

    // ERP Connectors
    'erp_connectors.title': 'Konektor ERP',
    'erp_connectors.stats.total': 'Total Konektor',
    'erp_connectors.stats.connected': 'Terkoneksi',
    'erp_connectors.stats.active': 'Aktif',
    'erp_connectors.stats.with_errors': 'Dengan Kesalahan',
    'erp_connectors.select_connector': 'Pilih Konektor',
    'erp_connectors.tabs.connectors': 'Konektor',
    'erp_connectors.tabs.webhooks': 'Webhook',
    'erp_connectors.tabs.sync_jobs': 'Job Sinkronisasi',
    'erp_connectors.tabs.logs': 'Log',
    'erp_connectors.name': 'Nama',
    'erp_connectors.type': 'Tipe',
    'erp_connectors.description': 'Deskripsi',
    'erp_connectors.base_url': 'URL Dasar',
    'erp_connectors.api_version': 'Versi API',
    'erp_connectors.auth_type': 'Tipe Auth',
    'erp_connectors.auth_config': 'Konfigurasi Auth',
    'erp_connectors.sync_frequency': 'Frekuensi Sinkronisasi',
    'erp_connectors.sync_direction': 'Arah Sinkronisasi',
    'erp_connectors.last_sync': 'Sinkronisasi Terakhir',
    'erp_connectors.error_count': 'Jumlah Kesalahan',
    'erp_connectors.status.connected': 'Terkoneksi',
    'erp_connectors.status.disconnected': 'Terputus',
    'erp_connectors.status.error': 'Kesalahan',
    'erp_connectors.status.testing': 'Menguji',
    'erp_connectors.frequency.manual': 'Manual',
    'erp_connectors.frequency.hourly': 'Per Jam',
    'erp_connectors.frequency.daily': 'Harian',
    'erp_connectors.frequency.weekly': 'Mingguan',
    'erp_connectors.frequency.monthly': 'Bulanan',
    'erp_connectors.add_connector': 'Tambah Konektor',
    'erp_connectors.test_connection': 'Tes Koneksi',
    'erp_connectors.webhooks': 'Webhook',
    'erp_connectors.event_type': 'Tipe Event',
    'erp_connectors.method': 'Metode',
    'erp_connectors.success_rate': 'Tingkat Keberhasilan',
    'erp_connectors.last_triggered': 'Terakhir Dipicu',
    'erp_connectors.add_webhook': 'Tambah Webhook',
    'erp_connectors.sync_jobs': 'Job Sinkronisasi',
    'erp_connectors.job_type': 'Tipe Job',
    'erp_connectors.entity_type': 'Tipe Entitas',
    'erp_connectors.sync_status.pending': 'Tertunda',
    'erp_connectors.sync_status.running': 'Berjalan',
    'erp_connectors.sync_status.completed': 'Selesai',
    'erp_connectors.sync_status.failed': 'Gagal',
    'erp_connectors.sync_status.cancelled': 'Dibatalkan',
    'erp_connectors.progress': 'Kemajuan',
    'erp_connectors.started_at': 'Dimulai Pada',
    'erp_connectors.add_sync_job': 'Tambah Job Sinkronisasi',
    'erp_connectors.execute': 'Jalankan',
    'erp_connectors.logs': 'Log',
    'erp_connectors.log_type.info': 'Info',
    'erp_connectors.log_type.warning': 'Peringatan',
    'erp_connectors.log_type.error': 'Kesalahan',
    'erp_connectors.log_type.debug': 'Debug',
    'erp_connectors.headers': 'Header',
    'erp_connectors.payload_template': 'Template Payload',
    'erp_connectors.endpoint_url': 'URL Endpoint',
    'nav.erp_connectors': 'Konektor ERP',

    // Document Integrations
    'document_integrations.title': 'Integrasi Dokumen',
    'document_integrations.stats.total_integrations': 'Total Integrasi',
    'document_integrations.stats.connected': 'Terkoneksi',
    'document_integrations.stats.total_files': 'Total File',
    'document_integrations.stats.storage_used': 'Penyimpanan Digunakan',
    'document_integrations.select_integration': 'Pilih Integrasi',
    'document_integrations.tabs.integrations': 'Integrasi',
    'document_integrations.tabs.sync_jobs': 'Job Sinkronisasi',
    'document_integrations.tabs.versions': 'Versi',
    'document_integrations.tabs.ocr': 'OCR',
    'document_integrations.name': 'Nama',
    'document_integrations.type': 'Tipe',
    'document_integrations.description': 'Deskripsi',
    'document_integrations.connection_config': 'Konfigurasi Koneksi',
    'document_integrations.sync_config': 'Konfigurasi Sinkronisasi',
    'document_integrations.sync_frequency': 'Frekuensi Sinkronisasi',
    'document_integrations.sync_direction': 'Arah Sinkronisasi',
    'document_integrations.last_sync': 'Sinkronisasi Terakhir',
    'document_integrations.folder_mappings': 'Pemetaan Folder',
    'document_integrations.conflict_resolution': 'Resolusi Konflik',
    'document_integrations.files_synced': 'File Tersinkronisasi',
    'document_integrations.add_integration': 'Tambah Integrasi',
    'document_integrations.test_connection': 'Tes Koneksi',
    'document_integrations.sync_jobs': 'Job Sinkronisasi',
    'document_integrations.job_type': 'Tipe Job',
    'document_integrations.direction': 'Arah',
    'document_integrations.status': 'Status',
    'document_integrations.progress': 'Kemajuan',
    'document_integrations.files': 'File',
    'document_integrations.started_at': 'Dimulai Pada',
    'document_integrations.add_sync_job': 'Tambah Job Sinkronisasi',
    'document_integrations.execute': 'Jalankan',
    'document_integrations.document_versions': 'Versi Dokumen',
    'document_integrations.file_name': 'Nama File',
    'document_integrations.file_size': 'Ukuran File',
    'document_integrations.mime_type': 'Tipe MIME',
    'document_integrations.sync_status': 'Status Sinkronisasi',
    'document_integrations.versions': 'Versi',
    'document_integrations.last_modified': 'Terakhir Diubah',
    'document_integrations.version_status.synced': 'Tersinkronisasi',
    'document_integrations.version_status.pending': 'Tertunda',
    'document_integrations.version_status.conflict': 'Konflik',
    'document_integrations.version_status.error': 'Kesalahan',
    'document_integrations.ocr_results': 'Hasil OCR',
    'document_integrations.document_id': 'ID Dokumen',
    'document_integrations.ocr_provider': 'Penyedia OCR',
    'document_integrations.confidence': 'Kepercayaan',
    'document_integrations.processing_time': 'Waktu Pemrosesan',
    'document_integrations.view_data': 'Lihat Data',
    'document_integrations.frequency.manual': 'Manual',
    'document_integrations.frequency.hourly': 'Per Jam',
    'document_integrations.frequency.daily': 'Harian',
    'document_integrations.frequency.weekly': 'Mingguan',
    'document_integrations.direction.inbound': 'Masuk',
    'document_integrations.direction.outbound': 'Keluar',
    'document_integrations.direction.bidirectional': 'Dua Arah',
    'document_integrations.status.connected': 'Terkoneksi',
    'document_integrations.status.disconnected': 'Terputus',
    'document_integrations.status.error': 'Kesalahan',
    'document_integrations.status.syncing': 'Menyinkronisasi',
    'document_integrations.sync_status.pending': 'Tertunda',
    'document_integrations.sync_status.running': 'Berjalan',
    'document_integrations.sync_status.completed': 'Selesai',
    'document_integrations.sync_status.failed': 'Gagal',
    'document_integrations.sync_status.cancelled': 'Dibatalkan',
    'document_integrations.ocr_status.pending': 'Tertunda',
    'document_integrations.ocr_status.processing': 'Memproses',
    'document_integrations.ocr_status.completed': 'Selesai',
    'document_integrations.ocr_status.failed': 'Gagal',
    'nav.document_integrations': 'Integrasi Dokumen',
    'nav.realtime': 'Pembaruan Real-time',

    // Real-time Updates (Indonesian)
    'admin.realtime.title': 'Manajer Real-time',
    'admin.realtime.total_connections': 'Total Koneksi',
    'admin.realtime.connected': 'Terkoneksi',
    'admin.realtime.total_messages': 'Total Pesan',
    'admin.realtime.total_events': 'Total Event',
    'admin.realtime.active_subscriptions': 'Langganan Aktif',
    'admin.realtime.active': 'Aktif',
    'admin.realtime.last_24h': '24 Jam Terakhir',
    'admin.realtime.processed': 'Diproses',
    'admin.realtime.connections': 'Koneksi',
    'admin.realtime.messages': 'Pesan',
    'admin.realtime.events': 'Event',
    'admin.realtime.subscriptions': 'Langganan',
    'admin.realtime.connection_name': 'Nama Koneksi',
    'admin.realtime.connection_type': 'Tipe Koneksi',
    'admin.realtime.connection_url': 'URL Koneksi',
    'admin.realtime.status': 'Status',
    'admin.realtime.last_activity': 'Aktivitas Terakhir',
    'admin.realtime.channel': 'Channel',
    'admin.realtime.payload': 'Payload',
    'admin.realtime.timestamp': 'Timestamp',
    'admin.realtime.event_type': 'Tipe Event',
    'admin.realtime.source': 'Sumber',
    'admin.realtime.data': 'Data',
    'admin.realtime.event_distribution': 'Distribusi Event',
    'admin.realtime.message_volume': 'Volume Pesan',
    'admin.realtime.new_connection': 'Koneksi Baru',
    'admin.realtime.create_connection': 'Buat Koneksi',
    'admin.realtime.send_message': 'Kirim Pesan',
    'admin.realtime.send': 'Kirim',
    'admin.realtime.subscribe': 'Berlangganan',
    'admin.realtime.created': 'Dibuat',
    'admin.realtime.module_not_available': 'Modul real-time tidak tersedia',
  },
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

function detectDefaultLanguage(): Language {
  try {
    const legacy = typeof localStorage !== 'undefined' ? (localStorage.getItem('lang') as Language | null) : null;
    const stored = typeof localStorage !== 'undefined' ? (localStorage.getItem('mpsone_lang') as Language | null) : null;
    const pref = stored ?? legacy;
    if (pref === 'en' || pref === 'id') return pref;
    const navLang = typeof navigator !== 'undefined' ? navigator.language.toLowerCase() : 'en';
    if (navLang.startsWith('id')) return 'id';
  } catch {}
  return 'en';
}

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguage] = useState<Language>('en');

  useEffect(() => {
    const next = detectDefaultLanguage();
    setLanguage(next);
  }, []);

  useEffect(() => {
    // Persist both legacy and new keys
    localStorage.setItem('lang', language);
    setPreferredLanguage(language);
  }, [language]);

  // Keep <html lang> aligned with current language for accessibility (WCAG)
  useEffect(() => {
    try {
      const html = document.documentElement;
      const langCode = language === 'id' ? 'id' : 'en';
      html.setAttribute('lang', langCode);
      // Explicitly set direction for clarity; both EN and ID are LTR
      html.setAttribute('dir', 'ltr');
    } catch {}
  }, [language]);

  // On first load, if no stored preference, hint language using IP geo (free, cached)
  useEffect(() => {
    const hasStored = !!(localStorage.getItem('mpsone_lang') || localStorage.getItem('lang'));
    if (hasStored) return;
    let cancelled = false;
    (async () => {
      try {
        const geo = await getGeoInfo();
        const next = getPreferredLanguage(geo.country);
        if (!cancelled) setLanguage(next);
      } catch {}
    })();
    return () => { cancelled = true; };
  }, []);

  const t = useMemo(() => {
    return (key: string) => {
      const table = translations[language];
      return table[key] ?? translations.en[key] ?? key;
    };
  }, [language]);

  const value: I18nContextValue = { language, setLanguage, t };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n(): I18nContextValue {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
