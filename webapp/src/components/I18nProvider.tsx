import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

export type Language = 'en' | 'id';

type I18nContextValue = {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
};

const translations: Record<Language, Record<string, string>> = {
  en: {
    // Auth / Login
    'auth.login_title': 'Sign in to MPSOne',
    'auth.login_subtitle': 'Enterprise procurement suite for Kalimantan mining companies',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.password_placeholder': 'Enter your password',
    'auth.remember_me': 'Remember me',
    'auth.forgot_password': 'Forgot password?',
    'auth.role': 'Sign in as',
    'auth.role_hint': 'Role-based permissions: Admin, PIC Operational, PIC Procurement, PIC Finance',
    'auth.sign_in': 'Sign In',
    'auth.or': 'or',
    'auth.sso': 'Sign in with SSO',
    'auth.sso_hint': 'SSO integration placeholder (Azure AD / Google Workspace)',
    'auth.security_notice': 'Security: WCAG AA, secure forms, and protected routes',
    'auth.version': 'Version {v}',
    'auth.login_success': 'Welcome {email}',
    'auth.error_email': 'Please enter a valid email address',
    'auth.error_password': 'Password must be at least 6 characters',
    'auth.choose_who': 'Who are you?',
    'auth.i_am_supplier': 'I am a Supplier',
    'auth.i_am_client': 'I am a Client',
    'auth.role_explain': 'Suppliers sign in as Admin. Clients choose a PIC role.',
    'auth.mode_supplier': 'Supplier mode selected',
    'auth.mode_client': 'Client mode selected',
    'auth.supplier_admin_assumed': 'Supplier Admin access assumed for this environment',
    'auth.use_code': 'Sign in with Code',
    'auth.join_with_code_hint': 'Enter the access code provided by your admin to auto-configure your account.',
    'auth.code_invalid': 'Invalid code',
    'auth.code_success': 'Access granted',
    'auth.code_number': 'Code number',
    'auth.continue': 'Continue',
    'department.name': 'Department',
    'clipboard.copied': 'Copied',

    // Role descriptions
    'roles.pic_operational_desc': 'Daily receiving, delivery confirmation, delivery letter corrections.',
    'roles.pic_procurement_desc': 'PR creation, supplier quotes, PO generation, vendor coordination.',
    'roles.pic_finance_desc': 'Invoice verification, payment scheduling, payment status tracking.',

    // Admin invites
    'admin.invite_user': 'Invite User',
    'admin.invites.title': 'Manage Invites',
    'admin.invites.none': 'No invites yet.',
    'admin.invites.code': 'Code',
    'admin.invites.expires_at': 'Expires At',
    'admin.invites.status': 'Status',
    'admin.invites.revoke': 'Revoke',
    // General
    'general.home': 'Home',

    // Navigation
    'nav.admin_dashboard': 'Admin Dashboard',
    'nav.client_dashboard': 'Client Dashboard',
    'nav.onboarding': 'Corporate Onboarding',
    'nav.purchase_requests': 'Purchase Requests',
    'nav.quote_builder': 'Quote Builder',
    'nav.order_tracker': 'Order Tracker',
    'nav.docs': 'Document Manager',
    'nav.comms': 'Communication Hub',
    'nav.email_dashboard': 'Email Dashboard',
    'nav.reporting': 'Reporting',

    // Topbar
    'topbar.light': 'Light',
    'topbar.dark': 'Dark',
    'topbar.neon': 'Neon',
    'topbar.mode': 'Mode',
    'topbar.theme': 'Theme',
    'topbar.quick_search': 'Search PRs, POs, quotes...',
    'topbar.notifications': 'Notifications',
    'topbar.unread': 'unread',
    'topbar.language': 'Language',
    'topbar.lang.en': 'English',
    'topbar.lang.id': 'Bahasa Indonesia',

    // Admin Dashboard
    'admin.title': 'Admin Dashboard',
    'admin.metrics.pending_quotes': 'Pending Quotes',
    'admin.metrics.active_pos': 'Active POs',
    'admin.metrics.unpaid_invoices': 'Unpaid Invoices',
    'admin.updated_hint': 'Updated 10m ago',
    'admin.comm_center': 'Client Communication Center',
    'admin.compose_email': 'Compose Email',
    'admin.recent_activity': 'Recent Activity',
    'admin.new_pr': 'New PR',
    'admin.new_quote': 'New Quote',
    'admin.new_po': 'New PO',

    // Activity strings
    'activity.created_quote': 'Created Quote {id} for {pr}',
    'activity.approved_po': 'Approved {po}',
    'activity.updated_budget': 'Updated budget for {dept}',

    // Time strings
    'time.today': 'Today',
    'time.yesterday': 'Yesterday',
    'time.hours_ago': '{n}h ago',
    'time.days_ago': '{n}d ago',

    // DataTable common
    'datatable.filter': 'Filter...',
    'datatable.export_csv': 'Export CSV',
    'datatable.export_pdf': 'Export PDF',
    'datatable.client_id': 'Client ID',
    'datatable.company': 'Company',
    'datatable.status': 'Status',
    'datatable.last_contact': 'Last Contact',
    'datatable.bulk_action': 'Bulk Action',
    'datatable.select_all': 'Select all',
    'datatable.prev': 'Prev',
    'datatable.next': 'Next',
    'datatable.page': 'Page',

    // Status values
    'status.active': 'Active',
    'status.pending_quote': 'Pending Quote',
    'status.po_issued': 'PO Issued',
    'status.shipped': 'Shipped',
    'status.unpaid': 'Unpaid',
    'status.processing': 'Processing',
    'status.delivered': 'Delivered',
    'status.invoiced': 'Invoiced',
    'status.paid': 'Paid',
    'status.pr': 'PR',
    'status.quote': 'Quote',
    'status.po': 'PO',

    // Client Dashboard
    'client.quick_pr': 'Quick PR',
    'client.quick_pr_desc': 'Create a purchase request with a few clicks.',
    'client.create_pr': 'Create PR',
    'client.budget_utilization': 'Budget Utilization',
    'client.documents': 'Documents',
    'client.welcome': 'Welcome, {company}',
    'client.order_tracking': 'Order Tracking',
    'client.document_label': 'Document',

    // Onboarding
    'onb.title': 'Corporate Onboarding',
    'onb.steps.company': 'Company',
    'onb.steps.hierarchy': 'Hierarchy',
    'onb.steps.roles': 'Roles',
    'onb.steps.budgets': 'Budgets',
    'onb.company_registration': 'Company Registration',
    'onb.company_name': 'Company Name',
    'onb.domain': 'Email Domain',
    'onb.hierarchy_setup': 'Hierarchy Setup',
    'onb.add_departments': 'Add departments for your organization',
    'onb.new_department': 'New Department',
    'onb.remove_last': 'Remove last',
    'onb.role_permissions': 'Role-based Permissions',
    'onb.select_roles': 'Select applicable roles',
    'onb.role_matrix': 'Permission Matrix',
    'onb.perm.create_pr': 'Create PRs',
    'onb.perm.approve_po': 'Approve POs',
    'onb.perm.manage_budgets': 'Manage Budgets',
    'onb.perm.view_finance': 'View Finance',
    'onb.department_budgets': 'Department Budgets',
    'onb.allocate_budgets': 'Allocate budgets per department',
    'onb.annual_budget': 'Annual Budget (IDR)',
    'onb.budget_allocation': 'Budget Allocation',
    'onb.total_budget': 'Total Budget',
    'onb.remaining': 'Remaining',
    'onb.finish': 'Finish',
    'onb.autosaved': 'Draft autosaved',
    'onb.err_over_budget': 'Allocated exceeds total budget',
    'onb.finish_success': 'Onboarding complete',

    // Document Manager
    'docs.title': 'Document Manager',
    'docs.list': 'Documents',
    'docs.bulk_download': 'Bulk Download',
    'docs.version': 'v{n}',
    'docs.access': 'Access',
    'docs.thumbnail': 'Thumbnail',
    'docs.delete_selected': 'Delete Selected',
    'docs.download': 'Download',
    'docs.selected': 'Selected: {n}',
    'docs.downloading': 'Downloading {n} files...',
    'docs.download_complete': 'Download complete',
    'docs.show_history': 'Show history',
    'docs.hide_history': 'Hide history',
    'docs.version_history': 'Version History',

    // Email Dashboard
    'email.title': 'Email Integration',
    'email.sync_status': 'Sync Status',
    'email.connected': 'Connected',
    'email.disconnected': 'Disconnected',
    'email.sync_desc': 'Two-way sync visualization between app and email. Configure CC/BCC rules per client type and manage templates.',
    'email.templates': 'Templates',
    'email.add_template': 'Add Template',
    'email.new_template': 'New Template',
    'email.name': 'Name',
    'email.subject': 'Subject',
    'email.updated': 'Updated',
    'email.rules': 'CC/BCC Rules',
    'email.client_type': 'Client Type',
    'email.cc': 'CC',
    'email.bcc': 'BCC',
    'email.enabled': 'Enabled',
    'email.toggle_enabled': 'Toggle',
    'email.save_rules': 'Save Rules',

    // Communication Hub
    'comms.title': 'Communication Hub',
    'comms.threads': 'Threads',
    'comms.unread': 'Unread: {n}',
    'comms.input_placeholder': 'Type a message. Use @mentions',
    'comms.email_integration': 'Email Integration',
    'comms.email_sync_desc': 'Two-way sync is visualized here. CC/BCC rules per client type are applied automatically.',
    'comms.connected_to': 'Connected to: {email}',
    'comms.add_attachments': 'Add attachments',
    'comms.attachments': 'Attachments',
    'comms.uploading': 'Uploading...',
    'comms.status.sent': 'Sent',
    'comms.status.delivered': 'Delivered',
    'comms.status.read': 'Read',

    // Reporting
    'reports.title': 'Reporting',
    'reports.spending_analytics': 'Spending Analytics',
    'reports.vendor_performance': 'Vendor Performance',
    'reports.budget_utilization': 'Budget Utilization',
    'reports.monthly_procurement': 'Monthly Procurement',

    // Order Tracker
    'order_tracker.title': 'Order Tracker',
    'order_tracker.estimated_delivery': 'Estimated delivery',
    'order_tracker.shipping_info': 'Shipping Information',
    'order_tracker.courier': 'Courier',
    'order_tracker.tracking_no': 'Tracking No',
    'order_tracker.delivery_proof': 'Delivery Proof',
    'order_tracker.drop_hint': 'Drag & drop files here or',
    'order_tracker.view_tracking': 'View tracking',
    'order_tracker.uploading': 'Uploading...',
    'order_tracker.upload_complete': 'Upload complete',
    'order_tracker.remove': 'Remove',
    'time.days': 'days',
    'time.hours': 'hours',
    'time.minutes': 'minutes',
    'action.upload': 'Upload',

    // PR List / Create
    'pr.header': 'Purchase Requests',
    'pr.total': 'total',
    'pr.new_pr': 'New PR',
    'pr.id': 'PR ID',
    'pr.title_label': 'Title',
    'pr.department': 'Department',
    'pr.status': 'Status',
    'pr.created': 'Created',
    'pr.details': 'Request Details',
    'pr.items': 'Items',
    'pr.approval_budget': 'Approval & Budget',
    'pr.step_of': 'Step {n} of {max}',
    'pr.files_drop_hint': 'Drag & drop files here or select to upload',
    'pr.uploading': 'Uploading',
    'pr.done': 'Done',
    'pr.item_spec': 'Specification',
    'pr.budget_code': 'Budget Code',
    'pr.approver': 'Approver',
    'pr.autosaved': 'Draft autosaved',
    'pr.submit_success': 'PR submitted successfully',
    'pr.err_title': 'Title is required',
    'pr.err_department': 'Department is required',
    'pr.err_needed_by': 'Needed by date required',
    'pr.err_items': 'At least one item is required',
    'pr.err_item_name': 'Item name required',
    'pr.err_item_qty': 'Quantity must be > 0',
    'pr.err_budget_code': 'Budget code required',
    'pr.err_approver': 'Approver required',

    // Common form labels/actions
    'form.title': 'Title',
    'form.department': 'Department',
    'form.needed_by': 'Needed By',
    'form.description': 'Description',
    'form.attach_files': 'Attach files',
    'form.last_saved': 'Last saved: {time}',
    'action.back': 'Back',
    'action.continue': 'Continue',
    'action.submit_pr': 'Submit PR',
    'action.add_item': 'Add Item',
    'action.remove': 'Remove',
    'action.export': 'Export',
    'action.send': 'Send',

    // Quote Builder
    'quote.items': 'Items',
    'quote.item': 'Item',
    'quote.qty': 'Qty',
    'quote.price': 'Price',
    'quote.total': 'Total',
    'quote.tax_rate': 'Tax Rate (%)',
    'quote.discount': 'Discount (IDR)',
    'quote.template': 'Template',
    'quote.subtotal': 'Subtotal',
    'quote.tax': 'Tax',
    'quote.grand_total': 'Grand Total',
    'action.preview': 'Preview',
    'action.close_preview': 'Close Preview',
    'action.send_quote': 'Send Quote',
    'quote.preview_hint': 'This is a template preview. Content will match selected style.',
  },
  id: {
    // Auth / Login
    'auth.login_title': 'Masuk ke MPSOne',
    'auth.login_subtitle': 'Suite pengadaan enterprise untuk perusahaan tambang Kalimantan',
    'auth.email': 'Email',
    'auth.password': 'Kata Sandi',
    'auth.password_placeholder': 'Masukkan kata sandi',
    'auth.remember_me': 'Ingat saya',
    'auth.forgot_password': 'Lupa kata sandi?',
    'auth.role': 'Masuk sebagai',
    'auth.role_hint': 'Hak akses berbasis peran: Admin, PIC Operasional, PIC Procurement, PIC Finance',
    'auth.sign_in': 'Masuk',
    'auth.or': 'atau',
    'auth.sso': 'Masuk dengan SSO',
    'auth.sso_hint': 'Placeholder integrasi SSO (Azure AD / Google Workspace)',
    'auth.security_notice': 'Keamanan: WCAG AA, formulir aman, dan rute terlindungi',
    'auth.version': 'Versi {v}',
    'auth.login_success': 'Selamat datang {email}',
    'auth.error_email': 'Harap masukkan alamat email yang valid',
    'auth.error_password': 'Kata sandi minimal 6 karakter',
    'auth.choose_who': 'Anda siapa?',
    'auth.i_am_supplier': 'Saya Supplier',
    'auth.i_am_client': 'Saya Klien',
    'auth.role_explain': 'Supplier masuk sebagai Admin. Klien memilih peran PIC.',
    'auth.mode_supplier': 'Mode Supplier dipilih',
    'auth.mode_client': 'Mode Klien dipilih',
    'auth.supplier_admin_assumed': 'Akses Admin Supplier diasumsikan untuk lingkungan ini',
    'auth.use_code': 'Masuk dengan Kode',
    'auth.join_with_code_hint': 'Masukkan kode akses dari admin untuk konfigurasi otomatis akun Anda.',
    'auth.code_invalid': 'Kode tidak valid',
    'auth.code_success': 'Akses diberikan',
    'auth.code_number': 'Nomor kode',
    'auth.continue': 'Lanjut',
    'department.name': 'Departemen',
    'clipboard.copied': 'Disalin',

    // Role descriptions
    'roles.pic_operational_desc': 'Penerimaan harian, konfirmasi pengiriman, koreksi surat jalan.',
    'roles.pic_procurement_desc': 'Pembuatan PR, penawaran pemasok, pembuatan PO, koordinasi vendor.',
    'roles.pic_finance_desc': 'Verifikasi tagihan, penjadwalan pembayaran, pelacakan status pembayaran.',

    // Admin invites
    'admin.invite_user': 'Undang Pengguna',
    'admin.invites.title': 'Kelola Undangan',
    'admin.invites.none': 'Belum ada undangan.',
    'admin.invites.code': 'Kode',
    'admin.invites.expires_at': 'Kedaluwarsa',
    'admin.invites.status': 'Status',
    'admin.invites.revoke': 'Batalkan',
    // General
    'general.home': 'Beranda',

    // Navigation
    'nav.admin_dashboard': 'Dasbor Admin',
    'nav.client_dashboard': 'Dasbor Klien',
    'nav.onboarding': 'Onboarding Perusahaan',
    'nav.purchase_requests': 'Permintaan Pembelian',
    'nav.quote_builder': 'Pembuat Penawaran',
    'nav.order_tracker': 'Pelacak Pesanan',
    'nav.docs': 'Manajer Dokumen',
    'nav.comms': 'Pusat Komunikasi',
    'nav.email_dashboard': 'Dasbor Email',
    'nav.reporting': 'Laporan',

    // Topbar
    'topbar.light': 'Terang',
    'topbar.dark': 'Gelap',
    'topbar.neon': 'Neon',
    'topbar.mode': 'Mode',
    'topbar.theme': 'Tema',
    'topbar.quick_search': 'Cari PR, PO, penawaran...',
    'topbar.notifications': 'Notifikasi',
    'topbar.unread': 'belum dibaca',
    'topbar.language': 'Bahasa',
    'topbar.lang.en': 'English',
    'topbar.lang.id': 'Bahasa Indonesia',

    // Admin Dashboard
    'admin.title': 'Dasbor Admin',
    'admin.metrics.pending_quotes': 'Penawaran Tertunda',
    'admin.metrics.active_pos': 'PO Aktif',
    'admin.metrics.unpaid_invoices': 'Tagihan Belum Dibayar',
    'admin.updated_hint': 'Diperbarui 10m lalu',
    'admin.comm_center': 'Pusat Komunikasi Klien',
    'admin.compose_email': 'Tulis Email',
    'admin.recent_activity': 'Aktivitas Terbaru',
    'admin.new_pr': 'PR Baru',
    'admin.new_quote': 'Penawaran Baru',
    'admin.new_po': 'PO Baru',

    // Activity strings
    'activity.created_quote': 'Membuat Penawaran {id} untuk {pr}',
    'activity.approved_po': 'Menyetujui {po}',
    'activity.updated_budget': 'Memperbarui anggaran untuk {dept}',

    // Time strings
    'time.today': 'Hari ini',
    'time.yesterday': 'Kemarin',
    'time.hours_ago': '{n}j lalu',
    'time.days_ago': '{n} hari lalu',
    'time.days': 'hari',

    // DataTable common
    'datatable.filter': 'Filter...',
    'datatable.export_csv': 'Ekspor CSV',
    'datatable.export_pdf': 'Ekspor PDF',
    'datatable.client_id': 'ID Klien',
    'datatable.company': 'Perusahaan',
    'datatable.status': 'Status',
    'datatable.last_contact': 'Kontak Terakhir',
    'datatable.bulk_action': 'Aksi Massal',
    'datatable.select_all': 'Pilih semua',
    'datatable.prev': 'Sebelumnya',
    'datatable.next': 'Berikutnya',
    'datatable.page': 'Halaman',

    // Status values
    'status.active': 'Aktif',
    'status.pending_quote': 'Menunggu Penawaran',
    'status.po_issued': 'PO Diterbitkan',
    'status.shipped': 'Dikirim',
    'status.unpaid': 'Belum Dibayar',
    'status.processing': 'Diproses',
    'status.delivered': 'Terkirim',
    'status.invoiced': 'Ditagihkan',
    'status.paid': 'Dibayar',
    'status.pr': 'PR',
    'status.quote': 'Penawaran',
    'status.po': 'PO',

    // Client Dashboard
    'client.quick_pr': 'PR Cepat',
    'client.quick_pr_desc': 'Buat PR hanya dengan beberapa klik.',
    'client.create_pr': 'Buat PR',
    'client.budget_utilization': 'Penggunaan Anggaran',
    'client.documents': 'Dokumen',
    'client.welcome': 'Selamat datang, {company}',
    'client.order_tracking': 'Pelacakan Pesanan',
    'client.document_label': 'Dokumen',

    // Onboarding
    'onb.title': 'Onboarding Perusahaan',
    'onb.steps.company': 'Perusahaan',
    'onb.steps.hierarchy': 'Hierarki',
    'onb.steps.roles': 'Peran',
    'onb.steps.budgets': 'Anggaran',
    'onb.company_registration': 'Registrasi Perusahaan',
    'onb.company_name': 'Nama Perusahaan',
    'onb.domain': 'Domain Email',
    'onb.hierarchy_setup': 'Pengaturan Hierarki',
    'onb.add_departments': 'Tambahkan departemen untuk organisasi Anda',
    'onb.new_department': 'Departemen Baru',
    'onb.remove_last': 'Hapus terakhir',
    'onb.role_permissions': 'Hak Akses Berbasis Peran',
    'onb.select_roles': 'Pilih peran yang berlaku',
    'onb.role_matrix': 'Matriks Hak Akses',
    'onb.perm.create_pr': 'Buat PR',
    'onb.perm.approve_po': 'Setujui PO',
    'onb.perm.manage_budgets': 'Kelola Anggaran',
    'onb.perm.view_finance': 'Lihat Keuangan',
    'onb.department_budgets': 'Anggaran Departemen',
    'onb.allocate_budgets': 'Alokasikan anggaran per departemen',
    'onb.annual_budget': 'Anggaran Tahunan (IDR)',
    'onb.budget_allocation': 'Alokasi Anggaran',
    'onb.total_budget': 'Total Anggaran',
    'onb.remaining': 'Sisa',
    'onb.finish': 'Selesai',
    'onb.autosaved': 'Draf tersimpan otomatis',
    'onb.err_over_budget': 'Alokasi melebihi total anggaran',
    'onb.finish_success': 'Onboarding selesai',

    // Document Manager
    'docs.title': 'Manajer Dokumen',
    'docs.list': 'Dokumen',
    'docs.bulk_download': 'Unduh Massal',
    'docs.version': 'v{n}',
    'docs.access': 'Akses',
    'docs.thumbnail': 'Gambar mini',
    'docs.delete_selected': 'Hapus Terpilih',
    'docs.download': 'Unduh',
    'docs.selected': 'Terpilih: {n}',
    'docs.downloading': 'Mengunduh {n} berkas...',
    'docs.download_complete': 'Unduh selesai',
    'docs.show_history': 'Tampilkan riwayat',
    'docs.hide_history': 'Sembunyikan riwayat',
    'docs.version_history': 'Riwayat Versi',

    // Email Dashboard
    'email.title': 'Integrasi Email',
    'email.sync_status': 'Status Sinkronisasi',
    'email.connected': 'Terhubung',
    'email.disconnected': 'Tidak Terhubung',
    'email.sync_desc': 'Visualisasi sinkronisasi dua-arah antara aplikasi dan email. Atur CC/BCC per tipe klien dan kelola templat.',
    'email.templates': 'Templat',
    'email.add_template': 'Tambah Templat',
    'email.new_template': 'Templat Baru',
    'email.name': 'Nama',
    'email.subject': 'Subjek',
    'email.updated': 'Diperbarui',
    'email.rules': 'Aturan CC/BCC',
    'email.client_type': 'Tipe Klien',
    'email.cc': 'CC',
    'email.bcc': 'BCC',
    'email.enabled': 'Aktif',
    'email.toggle_enabled': 'Ubah',
    'email.save_rules': 'Simpan Aturan',

    // Communication Hub
    'comms.title': 'Pusat Komunikasi',
    'comms.threads': 'Thread',
    'comms.unread': 'Belum dibaca: {n}',
    'comms.input_placeholder': 'Ketik pesan. Gunakan @mention',
    'comms.email_integration': 'Integrasi Email',
    'comms.email_sync_desc': 'Sinkronisasi dua-arah divisualisasikan di sini. Aturan CC/BCC per tipe klien diterapkan otomatis.',
    'comms.connected_to': 'Terhubung ke: {email}',
    'comms.add_attachments': 'Tambah lampiran',
    'comms.attachments': 'Lampiran',
    'comms.uploading': 'Mengunggah...',
    'comms.status.sent': 'Terkirim',
    'comms.status.delivered': 'Tersampaikan',
    'comms.status.read': 'Dibaca',

    // Reporting
    'reports.title': 'Laporan',
    'reports.spending_analytics': 'Analitik Pengeluaran',
    'reports.vendor_performance': 'Performa Vendor',
    'reports.budget_utilization': 'Pemanfaatan Anggaran',
    'reports.monthly_procurement': 'Pengadaan Bulanan',

    // Order Tracker
    'order_tracker.title': 'Pelacak Pesanan',
    'order_tracker.estimated_delivery': 'Perkiraan pengiriman',
    'order_tracker.shipping_info': 'Informasi Pengiriman',
    'order_tracker.courier': 'Kurir',
    'order_tracker.tracking_no': 'No Pelacakan',
    'order_tracker.delivery_proof': 'Bukti Pengiriman',
    'order_tracker.drop_hint': 'Tarik & letakkan berkas di sini atau',
    'order_tracker.view_tracking': 'Lihat pelacakan',
    'order_tracker.uploading': 'Mengunggah...',
    'order_tracker.upload_complete': 'Unggah selesai',
    'order_tracker.remove': 'Hapus',
    'time.hours': 'jam',
    'time.minutes': 'menit',

    // PR List / Create
    'pr.header': 'Permintaan Pembelian',
    'pr.total': 'total',
    'pr.new_pr': 'PR Baru',
    'pr.id': 'ID PR',
    'pr.title_label': 'Judul',
    'pr.department': 'Departemen',
    'pr.status': 'Status',
    'pr.created': 'Dibuat',
    'pr.details': 'Detail Permintaan',
    'pr.items': 'Item',
    'pr.approval_budget': 'Persetujuan & Anggaran',
    'pr.step_of': 'Langkah {n} dari {max}',
    'pr.files_drop_hint': 'Tarik & letakkan berkas di sini atau pilih untuk unggah',
    'pr.uploading': 'Mengunggah',
    'pr.done': 'Selesai',
    'pr.item_spec': 'Spesifikasi',
    'pr.budget_code': 'Kode Anggaran',
    'pr.approver': 'Penyetuju',
    'pr.autosaved': 'Draf tersimpan otomatis',
    'pr.submit_success': 'PR berhasil dikirim',
    'pr.err_title': 'Judul wajib diisi',
    'pr.err_department': 'Departemen wajib diisi',
    'pr.err_needed_by': 'Tanggal dibutuhkan wajib diisi',
    'pr.err_items': 'Minimal satu item wajib ada',
    'pr.err_item_name': 'Nama item wajib diisi',
    'pr.err_item_qty': 'Jumlah harus > 0',
    'pr.err_budget_code': 'Kode anggaran wajib diisi',
    'pr.err_approver': 'Penyetuju wajib diisi',

    // Common form labels/actions
    'form.title': 'Judul',
    'form.department': 'Departemen',
    'form.needed_by': 'Dibutuhkan Pada',
    'form.description': 'Deskripsi',
    'form.attach_files': 'Lampirkan berkas',
    'form.last_saved': 'Terakhir disimpan: {time}',
    'action.back': 'Kembali',
    'action.continue': 'Lanjut',
    'action.submit_pr': 'Kirim PR',
    'action.add_item': 'Tambah Item',
    'action.remove': 'Hapus',
    'action.export': 'Ekspor',
    'action.send': 'Kirim',

    // Quote Builder
    'quote.items': 'Item',
    'quote.item': 'Item',
    'quote.qty': 'Qty',
    'quote.price': 'Harga',
    'quote.total': 'Total',
    'quote.tax_rate': 'Pajak (%)',
    'quote.discount': 'Diskon (IDR)',
    'quote.template': 'Templat',
    'quote.subtotal': 'Subtotal',
    'quote.tax': 'Pajak',
    'quote.grand_total': 'Total Akhir',
    'action.preview': 'Pratinjau',
    'action.close_preview': 'Tutup Pratinjau',
    'action.send_quote': 'Kirim Penawaran',
    'quote.preview_hint': 'Ini adalah pratinjau templat. Konten akan mengikuti gaya terpilih.',
  },
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

function detectDefaultLanguage(): Language {
  const stored = localStorage.getItem('lang') as Language | null;
  if (stored === 'en' || stored === 'id') return stored;
  const nav = navigator?.language?.toLowerCase() ?? 'en';
  if (nav.startsWith('id')) return 'id';
  return 'en';
}

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguage] = useState<Language>(detectDefaultLanguage());

  useEffect(() => {
    localStorage.setItem('lang', language);
  }, [language]);

  const t = useMemo(() => {
    return (key: string) => {
      const table = translations[language];
      return table[key] ?? translations.en[key] ?? key;
    };
  }, [language]);

  const value: I18nContextValue = { language, setLanguage, t };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n(): I18nContextValue {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
